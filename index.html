<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Sales Summary 374959384</title>
  <!-- Bootstrap 5 CSS from jsDelivr CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* Small custom styling for the page */
    body { padding-top: 4rem; background-color: #f8f9fa; }
    .card { max-width: 720px; margin: 0 auto; }
    .monospace { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Courier New", monospace; }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
    <div class="container">
      <a class="navbar-brand" href="#">Sales Summary</a>
    </div>
  </nav>

  <main class="container">
    <div class="card mt-4 shadow-sm">
      <div class="card-body">
        <h1 class="card-title">Sales Summary 374959384</h1>
        <p class="card-text">This page reads the sales CSV and displays the summed sales value.</p>
        <div class="mb-3">
          <label class="form-label">Total Sales</label>
          <div id="total-sales" class="display-6 fw-bold monospace">Loading…</div>
        </div>
        <div>
          <button id="reload-btn" class="btn btn-outline-secondary">Reload</button>
        </div>
      </div>
    </div>
    <footer class="text-center text-muted mt-4">
      <small>Deployed for GitHub Pages — sums the sales column from data.csv</small>
    </footer>
  </main>

  <!-- Bootstrap Bundle (includes Popper) from jsDelivr CDN -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // Fetch the CSV file, parse it, sum the "sales" column and display the result.
    async function fetchAndSumSales() {
      const totalEl = document.getElementById('total-sales');
      totalEl.textContent = 'Loading…';
      try {
        const resp = await fetch('data.csv', {cache: 'no-store'});
        if (!resp.ok) throw new Error('Failed to fetch data.csv: ' + resp.status);
        const text = await resp.text();

        // Simple CSV parsing: split into lines, expect header row with "sales" column.
        const lines = text.trim().split(/\r?\n/);
        if (lines.length < 2) {
          totalEl.textContent = '0.00';
          return;
        }
        const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
        const salesIdx = headers.indexOf('sales');
        if (salesIdx === -1) throw new Error('sales column not found in CSV');

        let total = 0;
        for (let i = 1; i < lines.length; i++) {
          const line = lines[i].trim();
          if (!line) continue;
          // Respect comma inside quoted fields minimally by not supporting them (dataset expected simple).
          const cols = line.split(',');
          const raw = cols[salesIdx] ? cols[salesIdx].trim() : '';
          if (raw === '') continue;
          const value = parseFloat(raw);
          if (Number.isFinite(value)) total += value;
          // If parse fails, skip that row (robustness).
        }

        // Format to two decimals
        totalEl.textContent = total.toFixed(2);
      } catch (err) {
        console.error(err);
        totalEl.textContent = 'Error';
      }
    }

    document.getElementById('reload-btn').addEventListener('click', fetchAndSumSales);

    // Set document title explicitly as required by checks (already set in <title>, but ensure sync)
    document.title = 'Sales Summary 374959384';

    // Run on load
    window.addEventListener('load', fetchAndSumSales);
  </script>
</body>
</html>